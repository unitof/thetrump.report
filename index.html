<!DOCTYPE html>
<html>
<head>
	<title>The Trump Report</title>
	<!-- by Jacob Ford / @unitof -->
	<link rel="stylesheet" type="text/css" href="style.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.4.3/d3.min.js"></script>
	<script type="text/javascript">
		// lazy global variables because I'm not smart like those other guys
		let rcpAvg = {};
		let latestObj = {};
		let latestUnfavScore = 0;
		let latestFavScore = 0;
		let latestDate = new Date();

		function parseData(data) {
			rcpAvg = data.poll.rcp_avg;
			latestObj = rcpAvg[0]; // safer: sort by date?
			latestDate = new Date(latestObj.date);
			console.log("Updated", latestDate);
			latestFavScore = +latestObj.candidate[0].value;
			latestUnfavScore = +latestObj.candidate[1].value;
			console.log("  Unfav", latestUnfavScore);
			console.log("    Fav", latestFavScore);
		};

		function initFavBar() {
			d3.select("#mercury").attr('width', latestFavScore + "%");
			d3.select("#textlabel")
				.append('text')
					.attr('x', latestFavScore + "%")
					.attr('y', "50%")
					.html(latestFavScore + '%');
		}

		function vizData() {
			initFavBar();
		};

		function return_json(result) {
			parseData(result);
			vizData();
		};

		$.ajax({
			url: 'http://www.realclearpolitics.com/epolls/json/5493_historical.js?callback=return_json',
			dataType: 'jsonp',
			jsonpCallback: 'return_json'
		});
	</script>
</head>
<body>
	<svg id="trumpometer" width="100" height="100">
		<rect id="background" x="0" y="0" width="100%" height="100%"></rect>
		<rect id="mercury" x="0" y="0" width="0" height="100%"></rect>
		<g id="textlabel"></g>
	</svg>
	<!-- This is a simple bar graph representing Trump's percent approval, from RCP. More to come later. -->
	<!-- Ask the console for `latestDate` to learn how recent the score is. -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
		ga('create', 'UA-102151431-1', 'auto');
		ga('send', 'pageview');
	</script>
</body>
</html>
